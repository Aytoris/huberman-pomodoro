(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const g of o.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&c(g)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();const n={IDLE:"IDLE",FOCUS:"FOCUS",FOCUS_END:"FOCUS_END",REST:"REST",COMPLETE:"COMPLETE"},S={focusDuration:50,restDuration:10};class k{constructor(){this.currentState=n.IDLE,this.activeButtonIndex=null,this.completedSessions=this.loadProgress(),this.settings=this.loadSettings(),this.listeners=[]}subscribe(e){this.listeners.push(e)}notify(){this.listeners.forEach(e=>e(this.currentState,this))}setState(e){console.log(`State change: ${this.currentState} -> ${e}`),this.currentState=e,this.notify()}setActiveButton(e){this.activeButtonIndex=e}completeSession(){this.activeButtonIndex!==null&&(this.completedSessions.push(this.activeButtonIndex),this.activeButtonIndex=null,this.saveProgress(),this.notify())}loadProgress(){const e=localStorage.getItem("huberman-pomodoro-progress");return e?JSON.parse(e):[]}saveProgress(){localStorage.setItem("huberman-pomodoro-progress",JSON.stringify(this.completedSessions))}resetProgress(){this.completedSessions=[],this.saveProgress(),this.notify()}isSessionCompleted(e){return this.completedSessions.includes(e)}loadSettings(){const e=localStorage.getItem("huberman-pomodoro-settings");return e?{...S,...JSON.parse(e)}:{...S}}saveSettings(){localStorage.setItem("huberman-pomodoro-settings",JSON.stringify(this.settings))}updateSettings(e){this.settings={...this.settings,...e},this.saveSettings()}}const s=new k;class v{constructor(e,r,c){this.duration=e*60*1e3,this.remaining=this.duration,this.startTime=null,this.timerId=null,this.onTick=r,this.onComplete=c,this.isRunning=!1}start(){this.isRunning||(this.isRunning=!0,this.startTime=Date.now(),this.endTime=this.startTime+this.remaining,this.tick())}tick(){if(!this.isRunning)return;const e=Date.now();if(this.remaining=Math.max(0,this.endTime-e),this.onTick&&this.onTick(this.remaining,this.duration),this.remaining<=0){this.stop(),this.onComplete&&this.onComplete();return}this.timerId=requestAnimationFrame(()=>this.tick())}stop(){this.isRunning=!1,cancelAnimationFrame(this.timerId)}cancel(){this.stop(),this.remaining=this.duration}}let m=null;const C=async()=>{try{"wakeLock"in navigator?(m=await navigator.wakeLock.request("screen"),console.log("Wake Lock is active"),m.addEventListener("release",()=>{console.log("Wake Lock was released")})):console.warn("Wake Lock API not supported")}catch(t){console.error(`${t.name}, ${t.message}`)}},L=async()=>{if(m!==null)try{await m.release(),m=null}catch(t){console.error(`${t.name}, ${t.message}`)}},y=document.getElementById("menu-view"),l=document.getElementById("overlay-view"),d=document.getElementById("timer-display"),h=document.getElementById("message-display"),F=document.querySelectorAll(".session-btn"),a={updateButtons(t){F.forEach((e,r)=>{t.includes(r)?e.classList.add("completed"):e.classList.remove("completed")})},showOverlay(t){switch(y.classList.add("hidden"),l.classList.remove("hidden"),l.className="view",t){case n.FOCUS:l.classList.add("focus-running"),d.style.display="none",h.innerText="";break;case n.FOCUS_END:l.classList.add("focus-end"),d.style.display="none",h.innerText="Tap to Start Rest";break;case n.REST:l.classList.add("rest-running"),d.style.display="block",h.innerText="Resting...";break;case n.COMPLETE:l.classList.add("rest-end"),d.style.display="none",h.innerText="Session Complete. Tap to Return.";break}},hideOverlay(){l.classList.add("hidden"),y.classList.remove("hidden")},updateTimer(t,e){d.innerText=`${String(t).padStart(2,"0")}:${String(e).padStart(2,"0")}`}};let u=null;a.updateButtons(s.completedSessions);const T=document.getElementById("settings-modal"),p=document.getElementById("focus-duration"),f=document.getElementById("rest-duration"),I=document.getElementById("focus-val"),O=document.getElementById("rest-val");document.getElementById("settings-btn").addEventListener("click",()=>{const{focusDuration:t,restDuration:e}=s.settings;p.value=t,f.value=e,I.innerText=t,O.innerText=e,T.classList.remove("hidden")});document.getElementById("close-settings-btn").addEventListener("click",()=>{const t=parseInt(p.value),e=parseInt(f.value);s.updateSettings({focusDuration:t,restDuration:e}),T.classList.add("hidden")});p.addEventListener("input",t=>{I.innerText=t.target.value});f.addEventListener("input",t=>{O.innerText=t.target.value});document.querySelectorAll(".session-btn").forEach(t=>{t.addEventListener("click",()=>{const e=parseInt(t.dataset.index);B(e)})});document.getElementById("reset-btn").addEventListener("click",()=>{confirm("Reset all progress?")&&(s.resetProgress(),a.updateButtons(s.completedSessions))});const w=document.getElementById("overlay-view");w.addEventListener("click",t=>{s.currentState===n.FOCUS_END?b():s.currentState===n.COMPLETE&&P()});w.addEventListener("dblclick",t=>{(s.currentState===n.FOCUS||s.currentState===n.REST)&&R()});let E;document.addEventListener("mousemove",()=>{document.body.classList.remove("no-cursor"),clearTimeout(E),E=setTimeout(()=>{document.body.classList.add("no-cursor")},3e3)});async function B(t){if(s.isSessionCompleted(t)){const r=s.completedSessions.indexOf(t);if(r>-1){s.completedSessions.splice(r,1),s.saveProgress(),a.updateButtons(s.completedSessions);return}}if(s.setActiveButton(t),s.setState(n.FOCUS),a.showOverlay(n.FOCUS),await C(),document.documentElement.requestFullscreen)try{await document.documentElement.requestFullscreen()}catch(r){console.warn("Fullscreen denied:",r)}const e=s.settings.focusDuration;u=new v(e,null,()=>{D()}),u.start()}function D(){s.setState(n.FOCUS_END),a.showOverlay(n.FOCUS_END)}function b(){s.setState(n.REST),a.showOverlay(n.REST);const t=s.settings.restDuration;u=new v(t,(e,r)=>{const c=Math.ceil(e/1e3),i=Math.floor(c/60),o=c%60;a.updateTimer(i,o)},()=>{x()}),u.start()}function x(){s.setState(n.COMPLETE),a.showOverlay(n.COMPLETE)}function P(){s.completeSession(),s.setState(n.IDLE),a.hideOverlay(),L(),document.fullscreenElement&&document.exitFullscreen().catch(t=>console.log(t)),a.updateButtons(s.completedSessions)}async function R(){if(confirm("Are you sure you want to cancel the session?"))u&&u.cancel(),s.setState(n.IDLE),a.hideOverlay(),L(),document.fullscreenElement&&document.exitFullscreen().catch(t=>console.log(t));else if(document.documentElement.requestFullscreen)try{await document.documentElement.requestFullscreen()}catch(t){console.warn("Fullscreen denied:",t)}}
