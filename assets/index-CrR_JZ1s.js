(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const p of o.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&a(p)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();const n={IDLE:"IDLE",FOCUS:"FOCUS",FOCUS_END:"FOCUS_END",REST:"REST",COMPLETE:"COMPLETE"},y={FOCUS_DURATION_MIN:50,REST_DURATION_MIN:10};class T{constructor(){this.currentState=n.IDLE,this.activeButtonIndex=null,this.completedSessions=this.loadProgress(),this.listeners=[]}subscribe(e){this.listeners.push(e)}notify(){this.listeners.forEach(e=>e(this.currentState,this))}setState(e){console.log(`State change: ${this.currentState} -> ${e}`),this.currentState=e,this.notify()}setActiveButton(e){this.activeButtonIndex=e}completeSession(){this.activeButtonIndex!==null&&(this.completedSessions.push(this.activeButtonIndex),this.activeButtonIndex=null,this.saveProgress(),this.notify())}loadProgress(){const e=localStorage.getItem("huberman-pomodoro-progress");return e?JSON.parse(e):[]}saveProgress(){localStorage.setItem("huberman-pomodoro-progress",JSON.stringify(this.completedSessions))}resetProgress(){this.completedSessions=[],this.saveProgress(),this.notify()}isSessionCompleted(e){return this.completedSessions.includes(e)}}const s=new T;class g{constructor(e,r,a){this.duration=e*60*1e3,this.remaining=this.duration,this.startTime=null,this.timerId=null,this.onTick=r,this.onComplete=a,this.isRunning=!1}start(){this.isRunning||(this.isRunning=!0,this.startTime=Date.now(),this.endTime=this.startTime+this.remaining,this.tick())}tick(){if(!this.isRunning)return;const e=Date.now();if(this.remaining=Math.max(0,this.endTime-e),this.onTick&&this.onTick(this.remaining,this.duration),this.remaining<=0){this.stop(),this.onComplete&&this.onComplete();return}this.timerId=requestAnimationFrame(()=>this.tick())}stop(){this.isRunning=!1,cancelAnimationFrame(this.timerId)}cancel(){this.stop(),this.remaining=this.duration}}let m=null;const L=async()=>{try{"wakeLock"in navigator?(m=await navigator.wakeLock.request("screen"),console.log("Wake Lock is active"),m.addEventListener("release",()=>{console.log("Wake Lock was released")})):console.warn("Wake Lock API not supported")}catch(t){console.error(`${t.name}, ${t.message}`)}},E=async()=>{if(m!==null)try{await m.release(),m=null}catch(t){console.error(`${t.name}, ${t.message}`)}},S=document.getElementById("menu-view"),l=document.getElementById("overlay-view"),d=document.getElementById("timer-display"),h=document.getElementById("message-display"),O=document.querySelectorAll(".session-btn"),c={updateButtons(t){O.forEach((e,r)=>{t.includes(r)?e.classList.add("completed"):e.classList.remove("completed")})},showOverlay(t){switch(S.classList.add("hidden"),l.classList.remove("hidden"),l.className="view",t){case n.FOCUS:l.classList.add("focus-running"),d.style.display="none",h.innerText="";break;case n.FOCUS_END:l.classList.add("focus-end"),d.style.display="none",h.innerText="Tap to Start Rest";break;case n.REST:l.classList.add("rest-running"),d.style.display="block",h.innerText="Resting...";break;case n.COMPLETE:l.classList.add("rest-end"),d.style.display="none",h.innerText="Session Complete. Tap to Return.";break}},hideOverlay(){l.classList.add("hidden"),S.classList.remove("hidden")},updateTimer(t,e){d.innerText=`${String(t).padStart(2,"0")}:${String(e).padStart(2,"0")}`}};let u=null;c.updateButtons(s.completedSessions);document.querySelectorAll(".session-btn").forEach(t=>{t.addEventListener("click",()=>{const e=parseInt(t.dataset.index);I(e)})});document.getElementById("reset-btn").addEventListener("click",()=>{confirm("Reset all progress?")&&(s.resetProgress(),c.updateButtons(s.completedSessions))});const v=document.getElementById("overlay-view");v.addEventListener("click",t=>{s.currentState===n.FOCUS_END?C():s.currentState===n.COMPLETE&&F()});v.addEventListener("dblclick",t=>{(s.currentState===n.FOCUS||s.currentState===n.REST)&&R()});let f;document.addEventListener("mousemove",()=>{document.body.classList.remove("no-cursor"),clearTimeout(f),f=setTimeout(()=>{document.body.classList.add("no-cursor")},3e3)});async function I(t){if(s.isSessionCompleted(t)){const r=s.completedSessions.indexOf(t);if(r>-1){s.completedSessions.splice(r,1),s.saveProgress(),c.updateButtons(s.completedSessions);return}}if(s.setActiveButton(t),s.setState(n.FOCUS),c.showOverlay(n.FOCUS),await L(),document.documentElement.requestFullscreen)try{await document.documentElement.requestFullscreen()}catch(r){console.warn("Fullscreen denied:",r)}const e=y.FOCUS_DURATION_MIN;u=new g(e,null,()=>{w()}),u.start()}function w(){s.setState(n.FOCUS_END),c.showOverlay(n.FOCUS_END)}function C(){s.setState(n.REST),c.showOverlay(n.REST);const t=y.REST_DURATION_MIN;u=new g(t,(e,r)=>{const a=Math.ceil(e/1e3),i=Math.floor(a/60),o=a%60;c.updateTimer(i,o)},()=>{k()}),u.start()}function k(){s.setState(n.COMPLETE),c.showOverlay(n.COMPLETE)}function F(){s.completeSession(),s.setState(n.IDLE),c.hideOverlay(),E(),document.fullscreenElement&&document.exitFullscreen().catch(t=>console.log(t)),c.updateButtons(s.completedSessions)}async function R(){if(confirm("Are you sure you want to cancel the session?"))u&&u.cancel(),s.setState(n.IDLE),c.hideOverlay(),E(),document.fullscreenElement&&document.exitFullscreen().catch(t=>console.log(t));else if(document.documentElement.requestFullscreen)try{await document.documentElement.requestFullscreen()}catch(t){console.warn("Fullscreen denied:",t)}}
