(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const f of o.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&c(f)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();const n={IDLE:"IDLE",FOCUS:"FOCUS",FOCUS_END:"FOCUS_END",REST:"REST",COMPLETE:"COMPLETE"},g={FOCUS_DURATION_MIN:50,REST_DURATION_MIN:10,LONG_PRESS_DURATION_MS:2e3};class I{constructor(){this.currentState=n.IDLE,this.activeButtonIndex=null,this.completedSessions=this.loadProgress(),this.listeners=[]}subscribe(e){this.listeners.push(e)}notify(){this.listeners.forEach(e=>e(this.currentState,this))}setState(e){console.log(`State change: ${this.currentState} -> ${e}`),this.currentState=e,this.notify()}setActiveButton(e){this.activeButtonIndex=e}completeSession(){this.activeButtonIndex!==null&&(this.completedSessions.push(this.activeButtonIndex),this.activeButtonIndex=null,this.saveProgress(),this.notify())}loadProgress(){const e=localStorage.getItem("huberman-pomodoro-progress");return e?JSON.parse(e):[]}saveProgress(){localStorage.setItem("huberman-pomodoro-progress",JSON.stringify(this.completedSessions))}resetProgress(){this.completedSessions=[],this.saveProgress(),this.notify()}isSessionCompleted(e){return this.completedSessions.includes(e)}}const s=new I;class y{constructor(e,r,c){this.duration=e*60*1e3,this.remaining=this.duration,this.startTime=null,this.timerId=null,this.onTick=r,this.onComplete=c,this.isRunning=!1}start(){this.isRunning||(this.isRunning=!0,this.startTime=Date.now(),this.endTime=this.startTime+this.remaining,this.tick())}tick(){if(!this.isRunning)return;const e=Date.now();if(this.remaining=Math.max(0,this.endTime-e),this.onTick&&this.onTick(this.remaining,this.duration),this.remaining<=0){this.stop(),this.onComplete&&this.onComplete();return}this.timerId=requestAnimationFrame(()=>this.tick())}stop(){this.isRunning=!1,cancelAnimationFrame(this.timerId)}cancel(){this.stop(),this.remaining=this.duration}}let h=null;const C=async()=>{try{"wakeLock"in navigator?(h=await navigator.wakeLock.request("screen"),console.log("Wake Lock is active"),h.addEventListener("release",()=>{console.log("Wake Lock was released")})):console.warn("Wake Lock API not supported")}catch(t){console.error(`${t.name}, ${t.message}`)}},L=async()=>{if(h!==null)try{await h.release(),h=null}catch(t){console.error(`${t.name}, ${t.message}`)}},E=document.getElementById("menu-view"),l=document.getElementById("overlay-view"),m=document.getElementById("timer-display"),S=document.getElementById("message-display"),w=document.querySelectorAll(".session-btn"),a={updateButtons(t){w.forEach((e,r)=>{t.includes(r)?e.classList.add("completed"):e.classList.remove("completed")})},showOverlay(t){switch(E.classList.add("hidden"),l.classList.remove("hidden"),l.className="view",t){case n.FOCUS:l.classList.add("focus-running"),m.style.display="none",S.innerText="";break;case n.FOCUS_END:l.classList.add("focus-end"),m.style.display="none",S.innerText="Tap to Start Rest";break;case n.REST:l.classList.add("rest-running"),m.style.display="block",S.innerText="Resting...";break;case n.COMPLETE:l.classList.add("rest-end"),m.style.display="none",S.innerText="Session Complete. Tap to Return.";break}},hideOverlay(){l.classList.add("hidden"),E.classList.remove("hidden")},updateTimer(t,e){m.innerText=`${String(t).padStart(2,"0")}:${String(e).padStart(2,"0")}`}};let d=null,p=null;a.updateButtons(s.completedSessions);document.querySelectorAll(".session-btn").forEach(t=>{t.addEventListener("click",()=>{const e=parseInt(t.dataset.index);R(e)})});document.getElementById("reset-btn").addEventListener("click",()=>{confirm("Reset all progress?")&&(s.resetProgress(),a.updateButtons(s.completedSessions))});const u=document.getElementById("overlay-view"),v=t=>{p=setTimeout(()=>{T()},g.LONG_PRESS_DURATION_MS)},O=t=>{p&&(clearTimeout(p),p=null)};u.addEventListener("mousedown",v);u.addEventListener("touchstart",v,{passive:!0});u.addEventListener("mouseup",O);u.addEventListener("touchend",O);u.addEventListener("click",t=>{s.currentState===n.FOCUS_END?N():s.currentState===n.COMPLETE&&F()});u.addEventListener("dblclick",t=>{(s.currentState===n.FOCUS||s.currentState===n.REST)&&T()});async function R(t){if(s.isSessionCompleted(t)){const r=s.completedSessions.indexOf(t);if(r>-1){s.completedSessions.splice(r,1),s.saveProgress(),a.updateButtons(s.completedSessions);return}}if(s.setActiveButton(t),s.setState(n.FOCUS),a.showOverlay(n.FOCUS),await C(),document.documentElement.requestFullscreen)try{await document.documentElement.requestFullscreen()}catch(r){console.warn("Fullscreen denied:",r)}const e=g.FOCUS_DURATION_MIN;d=new y(e,null,()=>{k()}),d.start()}function k(){s.setState(n.FOCUS_END),a.showOverlay(n.FOCUS_END)}function N(){s.setState(n.REST),a.showOverlay(n.REST);const t=g.REST_DURATION_MIN;d=new y(t,(e,r)=>{const c=Math.ceil(e/1e3),i=Math.floor(c/60),o=c%60;a.updateTimer(i,o)},()=>{P()}),d.start()}function P(){s.setState(n.COMPLETE),a.showOverlay(n.COMPLETE)}function F(){s.completeSession(),s.setState(n.IDLE),a.hideOverlay(),L(),document.fullscreenElement&&document.exitFullscreen().catch(t=>console.log(t)),a.updateButtons(s.completedSessions)}function T(){d&&d.cancel(),s.setState(n.IDLE),a.hideOverlay(),L(),document.fullscreenElement&&document.exitFullscreen().catch(t=>console.log(t)),alert("Session Cancelled")}
